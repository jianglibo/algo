---
- name: Configure the server and install required software
  hosts: localhost
  gather_facts: false
  vars_files:
    - ../config.cfg
  tasks:
    - name: display file content
      debug:
        msg: "'{{ lookup('env', 'FC') }}' is the HOME environment variable."
    - name: can i override vars in config file?
      set_fact:
        users: ["ye"]
    - name: fail if users not as expected.
      fail:
        msg: "users is: {{ users }}"
      when: users != ["ye"]
    - name: Include vars of stuff.yaml into the 'stuff' variable (2.2).
      include_vars:
        file: iv.yml
        # name: stuff

    # - name: Load a variable file based on the OS type, or a default if not found. Using free-form to specify the file.
      # include_vars: "{{ lookup('first_found', params) }}"
      # include_vars: "{{ lookup('file', 't-cfg.yml') }}"
      # vars:
      #   params:
      #     files:
      #       - '{{ansible_distribution}}.yaml'
      #       - '{{ansible_os_family}}.yaml'
      #       - default.yaml
      #     paths:
      #       - 'vars'
    - name: fail if users not as expected.
      fail:
        msg: "users is: {{ users }}"
      when: users != ["ye"]
    - debug:
        var: stuff
    - name: full template
      set_fact:
        v: |
          [
          {% for i in [['a', 1],['b', 2],['c', 3]] %}
            {"{{i.0}}": {{i.1}}},
          {% endfor %}]

    - name: use full tempalte
      debug:
        var: v[0].a1
# export FC=linoxide.com
  # ansible-playbook --vault-id hetzner@/opt/respme/hetzner.pwd subbooks/t-env.yml
